# US013 - Fallback 302 vers la Home FR

## ğŸ“‹ Contexte
Lors de refontes multilingues, certaines langues ne sont pas migrÃ©es (budget, prioritÃ©, contenu incomplet). Les URLs de ces langues doivent Ãªtre redirigÃ©es temporairement vers la langue principale.

## ğŸ¯ User Story

**En tant que** responsable SEO multilingue,  
**je veux** que les URLs des langues absentes du nouveau site soient redirigÃ©es en 302 vers la page d'accueil en FR,  
**afin de** prÃ©server l'expÃ©rience utilisateur et Ã©viter les erreurs 404 en attendant la migration complÃ¨te.

## âœ… CritÃ¨res d'acceptation

### DÃ©tection automatique des langues manquantes
- [ ] Identification des langues prÃ©sentes dans ancien site mais absentes du nouveau
- [ ] Liste des langues concernÃ©es avec comptage d'URLs
- [ ] Alertes visuelles pour langues non migrÃ©es

### GÃ©nÃ©ration des redirections 302
- [ ] Redirection temporaire (302) au lieu de permanente (301)
- [ ] Cible configurable (par dÃ©faut : `/fr/`)
- [ ] Une seule redirection par langue manquante (toutes vers la mÃªme cible)
- [ ] Format Apache .htaccess compatible

### Interface de configuration
- [ ] SÃ©lection de la langue de fallback (FR, EN, DE...)
- [ ] Option : redirection vers home langue ou vers page Ã©quivalente  
- [ ] AperÃ§u des redirections 302 qui seront gÃ©nÃ©rÃ©es
- [ ] PossibilitÃ© d'exclure certaines langues du fallback

## ğŸ”§ Types de redirections gÃ©nÃ©rÃ©es

### Redirection vers la home (recommandÃ©)
```apache
# Toutes les pages ES â†’ Home FR
Redirect 302 /es/contacto /fr/
Redirect 302 /es/servicios /fr/
Redirect 302 /es/blog/articulo-1 /fr/
Redirect 302 /es/restaurante /fr/
```

### Avantages de cette approche
- **SimplicitÃ©** : Une seule cible par langue
- **CohÃ©rence** : ExpÃ©rience utilisateur unifiÃ©e  
- **SEO-friendly** : 302 temporaire prÃ©serve le futur retour de la langue
- **Performance** : Moins de redirections Ã  gÃ©rer

## ğŸ¨ Interface utilisateur

### DÃ©tection des langues manquantes
```
âš ï¸ Langues dÃ©tectÃ©es non migrÃ©es

ğŸ‡ªğŸ‡¸ Espagnol : 80 URLs dÃ©tectÃ©es
â”œâ”€â”€ /es/contacto
â”œâ”€â”€ /es/servicios  
â”œâ”€â”€ /es/blog/articulo-1
â””â”€â”€ ... 77 autres

ğŸ‡®ğŸ‡¹ Italien : 20 URLs dÃ©tectÃ©es
â”œâ”€â”€ /it/contatto
â”œâ”€â”€ /it/servizi
â””â”€â”€ ... 18 autres

ğŸ’¡ Ces langues seront redirigÃ©es vers la langue principale
```

### Configuration des fallbacks
```
ğŸ¯ Configuration des redirections 302

Langue de fallback : [ğŸ‡«ğŸ‡· FranÃ§ais â–¼]

ğŸ“‹ Redirections qui seront gÃ©nÃ©rÃ©es :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Langue      â”‚ URLs concernÃ©esâ”‚ Redirection â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‡ªğŸ‡¸ Espagnol â”‚ 80             â”‚ â†’ /fr/      â”‚
â”‚ ğŸ‡®ğŸ‡¹ Italien  â”‚ 20             â”‚ â†’ /fr/      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â˜‘ï¸ GÃ©nÃ©rer les redirections 302 automatiquement
â˜‘ï¸ Inclure dans le fichier .htaccess principal
```

## ğŸ”§ SpÃ©cifications techniques

### Classe FallbackManager
```python
class FallbackManager:
    def __init__(self, default_fallback_lang: str = 'fr'):
        self.default_fallback_lang = default_fallback_lang
    
    def detect_missing_languages(self, old_grouped: Dict, new_grouped: Dict) -> List[str]:
        """DÃ©tecte les langues prÃ©sentes dans ancien mais pas nouveau"""
        
    def generate_302_redirects(self, missing_langs: List[str], old_urls: Dict) -> List[Tuple[str, str]]:
        """GÃ©nÃ¨re les redirections 302 pour langues manquantes"""
        
    def format_htaccess_302(self, redirects: List[Tuple[str, str]]) -> str:
        """Formate les redirections 302 en syntaxe Apache"""
```

### Algorithme de gÃ©nÃ©ration
```python
def generate_302_redirects(missing_langs, old_urls_grouped, fallback_lang='fr'):
    redirects = []
    
    for lang in missing_langs:
        if lang in old_urls_grouped:
            for url in old_urls_grouped[lang]:
                # Toutes les URLs de cette langue â†’ home fallback
                redirect = (url, f'/{fallback_lang}/')
                redirects.append(redirect)
    
    return redirects
```

### Format de sortie .htaccess
```apache
# Redirections temporaires pour langues non migrÃ©es
# GÃ©nÃ©rÃ©es automatiquement par 301 Redirect Generator

# Espagnol â†’ FranÃ§ais (temporaire)
Redirect 302 /es/contacto /fr/
Redirect 302 /es/servicios /fr/
Redirect 302 /es/blog/articulo-1 /fr/
Redirect 302 /es/restaurante /fr/

# Italien â†’ FranÃ§ais (temporaire)  
Redirect 302 /it/contatto /fr/
Redirect 302 /it/servizi /fr/
```

## ğŸ§ª ScÃ©narios de test

### Test 1: Langue complÃ¨tement absente
```
DonnÃ©:
- Ancien: ES (80 URLs), IT (20 URLs)
- Nouveau: Aucune URL ES/IT
- Fallback: FR

Attendu:
- 80 redirections 302: /es/* â†’ /fr/
- 20 redirections 302: /it/* â†’ /fr/
- Type: Redirect 302 (temporaire)
```

### Test 2: Langues partiellement migrÃ©es
```
DonnÃ©:
- Ancien EN: 200 URLs
- Nouveau EN: 50 URLs
- Fallback: FR

Attendu:
- 50 meilleures correspondances ENâ†’EN (301)
- 150 redirections 302: /en/* â†’ /fr/
```

### Test 3: Configuration personnalisÃ©e
```
DonnÃ©:
- Langues manquantes: ES, IT
- Fallback personnalisÃ©: EN (au lieu de FR)

Attendu:
- Toutes redirections ES/IT â†’ /en/
```

## ğŸ“Š Statistiques des fallbacks

### Rapport des redirections 302
```
ğŸ“ˆ Rapport des redirections temporaires

ğŸ‡ªğŸ‡¸ Espagnol (non migrÃ©):
â”œâ”€â”€ 80 URLs concernÃ©es
â”œâ”€â”€ Toutes â†’ /fr/ (302 temporaire)
â”œâ”€â”€ Impact SEO: Temporaire, sans perte de ranking
â””â”€â”€ Action recommandÃ©e: Planifier migration ES

ğŸ‡®ğŸ‡¹ Italien (non migrÃ©):
â”œâ”€â”€ 20 URLs concernÃ©es  
â”œâ”€â”€ Toutes â†’ /fr/ (302 temporaire)
â”œâ”€â”€ Impact SEO: Temporaire, sans perte de ranking
â””â”€â”€ Action recommandÃ©e: Ã‰valuer ROI migration IT

ğŸ’¡ Total : 100 redirections 302 gÃ©nÃ©rÃ©es
```

### MÃ©triques de suivi
- **URLs temporaires** : Nombre total de redirections 302
- **Langues impactÃ©es** : Nombre de langues non migrÃ©es
- **Taux de fallback** : % d'URLs en redirection temporaire
- **Cible principale** : Langue de destination majoritaire

## ğŸš« Exclusions

- Redirection 301 permanente pour langues manquantes (SEO incorrect)
- Correspondances inter-langues (ex: ESâ†’EN automatique)
- Redirection vers pages spÃ©cifiques (complexitÃ© excessive)
- Gestion des sous-domaines multilingues (hors scope v1)

## ğŸ”„ Statut
**ğŸ”„ Ã€ dÃ©velopper** - Module de fallback avec redirections 302

---

*US013 dÃ©veloppÃ©e pour SEPTEO Digital Services*  
*Fallbacks 302 pour langues non migrÃ©es*