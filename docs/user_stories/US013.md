# US013 - Fallback 302 vers la Home FR

## 📋 Contexte
Lors de refontes multilingues, certaines langues ne sont pas migrées (budget, priorité, contenu incomplet). Les URLs de ces langues doivent être redirigées temporairement vers la langue principale.

## 🎯 User Story

**En tant que** responsable SEO multilingue,  
**je veux** que les URLs des langues absentes du nouveau site soient redirigées en 302 vers la page d'accueil en FR,  
**afin de** préserver l'expérience utilisateur et éviter les erreurs 404 en attendant la migration complète.

## ✅ Critères d'acceptation

### Détection automatique des langues manquantes
- [ ] Identification des langues présentes dans ancien site mais absentes du nouveau
- [ ] Liste des langues concernées avec comptage d'URLs
- [ ] Alertes visuelles pour langues non migrées

### Génération des redirections 302
- [ ] Redirection temporaire (302) au lieu de permanente (301)
- [ ] Cible configurable (par défaut : `/fr/`)
- [ ] Une seule redirection par langue manquante (toutes vers la même cible)
- [ ] Format Apache .htaccess compatible

### Interface de configuration
- [ ] Sélection de la langue de fallback (FR, EN, DE...)
- [ ] Option : redirection vers home langue ou vers page équivalente  
- [ ] Aperçu des redirections 302 qui seront générées
- [ ] Possibilité d'exclure certaines langues du fallback

## 🔧 Types de redirections générées

### Redirection vers la home (recommandé)
```apache
# Toutes les pages ES → Home FR
Redirect 302 /es/contacto /fr/
Redirect 302 /es/servicios /fr/
Redirect 302 /es/blog/articulo-1 /fr/
Redirect 302 /es/restaurante /fr/
```

### Avantages de cette approche
- **Simplicité** : Une seule cible par langue
- **Cohérence** : Expérience utilisateur unifiée  
- **SEO-friendly** : 302 temporaire préserve le futur retour de la langue
- **Performance** : Moins de redirections à gérer

## 🎨 Interface utilisateur

### Détection des langues manquantes
```
⚠️ Langues détectées non migrées

🇪🇸 Espagnol : 80 URLs détectées
├── /es/contacto
├── /es/servicios  
├── /es/blog/articulo-1
└── ... 77 autres

🇮🇹 Italien : 20 URLs détectées
├── /it/contatto
├── /it/servizi
└── ... 18 autres

💡 Ces langues seront redirigées vers la langue principale
```

### Configuration des fallbacks
```
🎯 Configuration des redirections 302

Langue de fallback : [🇫🇷 Français ▼]

📋 Redirections qui seront générées :
┌─────────────┬────────────────┬─────────────┐
│ Langue      │ URLs concernées│ Redirection │
├─────────────┼────────────────┼─────────────┤
│ 🇪🇸 Espagnol │ 80             │ → /fr/      │
│ 🇮🇹 Italien  │ 20             │ → /fr/      │
└─────────────┴────────────────┴─────────────┘

☑️ Générer les redirections 302 automatiquement
☑️ Inclure dans le fichier .htaccess principal
```

## 🔧 Spécifications techniques

### Classe FallbackManager
```python
class FallbackManager:
    def __init__(self, default_fallback_lang: str = 'fr'):
        self.default_fallback_lang = default_fallback_lang
    
    def detect_missing_languages(self, old_grouped: Dict, new_grouped: Dict) -> List[str]:
        """Détecte les langues présentes dans ancien mais pas nouveau"""
        
    def generate_302_redirects(self, missing_langs: List[str], old_urls: Dict) -> List[Tuple[str, str]]:
        """Génère les redirections 302 pour langues manquantes"""
        
    def format_htaccess_302(self, redirects: List[Tuple[str, str]]) -> str:
        """Formate les redirections 302 en syntaxe Apache"""
```

### Algorithme de génération
```python
def generate_302_redirects(missing_langs, old_urls_grouped, fallback_lang='fr'):
    redirects = []
    
    for lang in missing_langs:
        if lang in old_urls_grouped:
            for url in old_urls_grouped[lang]:
                # Toutes les URLs de cette langue → home fallback
                redirect = (url, f'/{fallback_lang}/')
                redirects.append(redirect)
    
    return redirects
```

### Format de sortie .htaccess
```apache
# Redirections temporaires pour langues non migrées
# Générées automatiquement par 301 Redirect Generator

# Espagnol → Français (temporaire)
Redirect 302 /es/contacto /fr/
Redirect 302 /es/servicios /fr/
Redirect 302 /es/blog/articulo-1 /fr/
Redirect 302 /es/restaurante /fr/

# Italien → Français (temporaire)  
Redirect 302 /it/contatto /fr/
Redirect 302 /it/servizi /fr/
```

## 🧪 Scénarios de test

### Test 1: Langue complètement absente
```
Donné:
- Ancien: ES (80 URLs), IT (20 URLs)
- Nouveau: Aucune URL ES/IT
- Fallback: FR

Attendu:
- 80 redirections 302: /es/* → /fr/
- 20 redirections 302: /it/* → /fr/
- Type: Redirect 302 (temporaire)
```

### Test 2: Langues partiellement migrées
```
Donné:
- Ancien EN: 200 URLs
- Nouveau EN: 50 URLs
- Fallback: FR

Attendu:
- 50 meilleures correspondances EN→EN (301)
- 150 redirections 302: /en/* → /fr/
```

### Test 3: Configuration personnalisée
```
Donné:
- Langues manquantes: ES, IT
- Fallback personnalisé: EN (au lieu de FR)

Attendu:
- Toutes redirections ES/IT → /en/
```

## 📊 Statistiques des fallbacks

### Rapport des redirections 302
```
📈 Rapport des redirections temporaires

🇪🇸 Espagnol (non migré):
├── 80 URLs concernées
├── Toutes → /fr/ (302 temporaire)
├── Impact SEO: Temporaire, sans perte de ranking
└── Action recommandée: Planifier migration ES

🇮🇹 Italien (non migré):
├── 20 URLs concernées  
├── Toutes → /fr/ (302 temporaire)
├── Impact SEO: Temporaire, sans perte de ranking
└── Action recommandée: Évaluer ROI migration IT

💡 Total : 100 redirections 302 générées
```

### Métriques de suivi
- **URLs temporaires** : Nombre total de redirections 302
- **Langues impactées** : Nombre de langues non migrées
- **Taux de fallback** : % d'URLs en redirection temporaire
- **Cible principale** : Langue de destination majoritaire

## 🚫 Exclusions

- Redirection 301 permanente pour langues manquantes (SEO incorrect)
- Correspondances inter-langues (ex: ES→EN automatique)
- Redirection vers pages spécifiques (complexité excessive)
- Gestion des sous-domaines multilingues (hors scope v1)

## 🔄 Statut
**🔄 À développer** - Module de fallback avec redirections 302

---

*US013 développée pour SEPTEO Digital Services*  
*Fallbacks 302 pour langues non migrées*