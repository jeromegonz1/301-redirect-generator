# US007 - Parsing du sitemap Yoast pour le site nouveau

## ğŸ“‹ Contexte
Suite Ã  l'analyse que le nouveau site en prÃ©production est souvent bloquÃ© par `robots.txt`, `noindex` ou authentification, nous avons adaptÃ© la stratÃ©gie de collecte des URLs pour utiliser le parsing du sitemap XML plutÃ´t que le scraping.

## ğŸ¯ Objectif
Permettre le parsing rÃ©cursif des sitemaps Yoast (incluant les sitemaps index avec sous-sitemaps) pour extraire toutes les URLs du nouveau site en prÃ©production.

## âœ… CritÃ¨res d'acceptation

- [x] Parser un sitemap XML standard
- [x] DÃ©tecter et parser rÃ©cursivement les sitemaps index
- [x] Extraire les URLs des sous-sitemaps (post-sitemap.xml, page-sitemap.xml, category-sitemap.xml, etc.)
- [x] Ã‰viter les boucles infinies lors du parsing rÃ©cursif
- [x] Convertir les URLs absolues en URLs relatives pour le matching
- [x] GÃ©rer les erreurs de connexion et de parsing gracieusement

## ğŸ”§ ImplÃ©mentation

### Fonction backend : `parse_sitemap()`

```python
def parse_sitemap(sitemap_url: str, recursive: bool = True, _visited: set = None) -> List[str]
```

**ParamÃ¨tres :**
- `sitemap_url` : URL du sitemap Ã  parser
- `recursive` : Si True, parse rÃ©cursivement les sitemaps index
- `_visited` : Set interne pour Ã©viter les boucles infinies

**FonctionnalitÃ©s :**
- DÃ©tection automatique des sous-sitemaps (patterns : sitemap*.xml, *-sitemap.xml, post-sitemap, page-sitemap, etc.)
- Parsing rÃ©cursif avec protection contre les boucles
- Support des sitemaps Yoast SEO et standards
- User-Agent dÃ©diÃ© : "301-Redirect-Bot (Sitemap Parser)"

### IntÃ©gration frontend

Dans l'interface Streamlit :
- Champ dÃ©diÃ© pour l'URL du sitemap du nouveau site
- Suggestions d'URLs courantes (`/sitemap.xml`, `/sitemap_index.xml`, `/wp-sitemap.xml`)
- Bouton "ğŸ“„ Parser le sitemap" distinct du scraping
- Affichage du nombre d'URLs trouvÃ©es avec aperÃ§u

## ğŸ“Š RÃ©sultats de test

Test avec sitemap rÃ©el : `http://72.web.thelis.es:30178/les-cascades/sitemap_index.xml`

```
âœ… Sitemap index dÃ©tectÃ© et parsÃ©
  â†’ post-sitemap.xml : 105 URLs
  â†’ page-sitemap.xml : 442 URLs  
  â†’ category-sitemap.xml : 4 URLs
Total : 549 URLs extraites
```

## ğŸš€ Statut
**âœ… TERMINÃ‰E** - ImplÃ©mentÃ©e et testÃ©e avec succÃ¨s

## ğŸ“ Notes techniques
- Utilisation de BeautifulSoup avec parser lxml pour robustesse
- Conversion automatique des URLs absolues en relatives
- Gestion des timeouts (30 secondes par sitemap)
- DÃ©doublonnage automatique des URLs