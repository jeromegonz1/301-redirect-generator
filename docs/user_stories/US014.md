# US014 - Prompt Contextuel du Chef de Projet

## 📋 Contexte
L'IA de matching a besoin de contexte métier pour bien comprendre les changements de structure, terminologie, et stratégie éditoriale entre ancien et nouveau site.

## 🎯 User Story

**En tant que** chef de projet digital,  
**je veux** pouvoir transmettre un prompt personnalisé à l'IA pour lui expliquer le contexte éditorial du site,  
**afin d'** obtenir un matching plus pertinent et métier-aware.

## ✅ Critères d'acceptation

### Interface de saisie contextuelle
- [ ] Zone de texte large pour instructions libres (500+ caractères)
- [ ] Placeholder avec exemples concrets d'instructions utiles
- [ ] Sauvegarde automatique du contexte en session
- [ ] Templates pré-remplis pour cas courants

### Injection dans le prompt IA
- [ ] Contexte injecté au début du prompt système GPT
- [ ] Formatage automatique pour optimiser la compréhension IA
- [ ] Gestion des instructions multilingues
- [ ] Limitation de taille (max 1000 caractères) pour éviter les coûts

### Types d'instructions supportées
- [ ] **Renommage de sections** : "blog devient actualités"
- [ ] **Langues actives/inactives** : "ES non migré"
- [ ] **Structure éditoriale** : "pages principales vs blog"
- [ ] **Terminologie métier** : "mobil-home devient nos locatifs"
- [ ] **Priorités SEO** : "préserver les URLs à fort trafic"

## 🎨 Interface utilisateur

### Zone de saisie contextuelle
```
💬 Instructions pour l'IA (optionnel mais recommandé)

┌─────────────────────────────────────────────────────────────┐
│ Expliquez le contexte de votre refonte à l'IA :            │
│                                                             │
│ Le site est en FR/EN/DE. Le contenu ES n'a pas été migré. │
│ Les sections ont changé :                                   │
│ - "mobil-home" devient "nos locatifs"                      │
│ - "blog" devient "actualités"                              │
│ - "restaurant" devient "restauration"                       │
│                                                             │
│ Structure éditoriale :                                      │
│ - Pages principales : /presentation, /hebergement          │
│ - Blog : /actualites/[slug]                                │
│ - Langues : /fr/, /en/, /de/                               │
└─────────────────────────────────────────────────────────────┘

💡 Plus le contexte est précis, meilleur sera le matching !
Caractères : 287/1000
```

### Templates prédéfinis
```
📋 Templates courants (cliquer pour remplir) :

[🏨 Site hôtellerie] [🏪 E-commerce] [🏢 Corporate] [📰 Blog/Média]

Template "Site hôtellerie" :
- Services → Prestations
- Réservation → Booking  
- Chambres → Hébergements
- Restaurant → Restauration
- Langues : FR/EN principales
```

## 💬 Exemples d'instructions efficaces

### Exemple 1: Refonte hôtellerie
```
Le camping devient un resort 4*. 
Vocabulaire upgrading:
- "mobil-home" → "villa premium"
- "emplacement" → "espace privatif"
- "restaurant" → "gastronomie"
- "animations" → "expériences"

Structure nouvelle:
- /hebergements/ (villas, emplacements)
- /experiences/ (ex-animations)
- /gastronomie/ (ex-restaurant)
```

### Exemple 2: Refonte multilingue
```
Site corporate FR/EN/DE.
- Contenu ES/IT archivé (redirection /fr/)
- "Nos solutions" → "Our solutions" → "Unsere Lösungen"
- Blog centralisé : /actualites/, /news/, /nachrichten/
- Pages commerciales prioritaires SEO
```

### Exemple 3: Refonte e-commerce
```
Migration Prestashop → Shopify.
Catégories renommées:
- "Électronique" → "High-tech"
- "Maison & Jardin" → "Lifestyle"
- "Vêtements" → "Mode"

URLs produits: /p/[slug] → /products/[slug]
Categories: /c/[slug] → /collections/[slug]
```

## 🔧 Implémentation technique

### Injection dans le prompt GPT
```python
def build_context_prompt(user_context: str, language: str = "fr") -> str:
    system_prompt = f"""
Tu es un expert en redirections 301 pour des refontes de sites web.

CONTEXTE MÉTIER FOURNI PAR LE CHEF DE PROJET :
{user_context}

Utilise ce contexte pour comprendre :
- Les changements de terminologie
- La nouvelle structure éditoriale  
- Les langues actives/inactives
- Les priorités SEO du projet

Instructions générales :
- Analyse le sens et le contenu de chaque URL
- Priorise les correspondances exactes
- Utilise le contexte métier pour les cas ambigus
- Confidence entre 0.0 et 1.0
"""
    return system_prompt
```

### Classe ContextualAIMapper
```python
class ContextualAIMapper(AIMapper):
    def __init__(self, api_key: str):
        super().__init__(api_key)
        self.user_context = ""
    
    def set_context(self, context: str):
        """Définit le contexte métier"""
        self.user_context = self.validate_and_format_context(context)
    
    def validate_and_format_context(self, context: str) -> str:
        """Valide et formate le contexte utilisateur"""
        # Limitation de taille
        if len(context) > 1000:
            context = context[:1000] + "..."
        
        # Formatage pour optimiser la compréhension IA
        formatted = f"""
        CONTEXTE PROJET :
        {context}
        
        INSTRUCTIONS DE MATCHING :
        - Utilise ce contexte pour tous les matchings
        - En cas d'ambiguïté, priorise les informations ci-dessus
        - Mentionne le contexte dans tes raisons de matching
        """
        
        return formatted
```

## 🧪 Impact sur la qualité du matching

### Avant contexte (matching générique)
```
/mobil-home-luxe → /hebergements (confidence: 0.65)
Raison: "Correspondance approximative basée sur le logement"
```

### Après contexte métier
```
/mobil-home-luxe → /nos-locatifs (confidence: 0.92)  
Raison: "Contexte projet: 'mobil-home devient nos locatifs'"
```

### Exemples d'amélioration
| URL ancienne | Sans contexte | Avec contexte | Gain |
|--------------|---------------|---------------|------|
| `/blog/article-1` | `/actualites/` (0.70) | `/actualites/article-1` (0.95) | +25% |
| `/restaurant-gard` | `/services` (0.60) | `/restauration` (0.90) | +30% |
| `/camping-presentation` | `/accueil` (0.50) | `/presentation` (0.95) | +45% |

## 📊 Métriques d'efficacité

### Amélioration du matching
```
📈 Impact du contexte métier sur la qualité

Sans contexte utilisateur :
├── Confidence moyenne : 0.74
├── Suggestions > 0.9 : 23%
└── Validation humaine : 68%

Avec contexte utilisateur :
├── Confidence moyenne : 0.87 (+18%)
├── Suggestions > 0.9 : 45% (+22%)
└── Validation humaine : 89% (+21%)

💡 Gain moyen : +20% de qualité de matching
```

### Templates les plus efficaces
1. **Renommage terminologie** : +25% de précision
2. **Structure éditoriale** : +20% de précision  
3. **Langues actives/inactives** : +15% de précision
4. **Priorités SEO** : +10% de précision

## 🚫 Exclusions

- Génération automatique du contexte (analyse de contenu)
- Templates spécialisés par secteur (v1 générique)
- Contexte multilingue automatique (saisie manuelle)
- Apprentissage et mémorisation entre sessions

## 🔄 Statut
**🔄 À développer** - Interface contextuelle + injection prompt GPT

---

*US014 développée pour SEPTEO Digital Services*  
*Prompt contextuel pour matching IA métier-aware*