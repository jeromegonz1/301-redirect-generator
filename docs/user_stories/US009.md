# US009 - Matching IA Sémantique

## 📋 Contexte
Le matching ligne-par-ligne atteint ses limites face aux refontes avec structures différentes et déséquilibres d'URLs (800 anciennes vs 549 nouvelles).

## 🎯 User Story

**En tant que** chef de projet digital,  
**je veux** que l'outil associe chaque ancienne URL à la nouvelle URL la plus proche sémantiquement en utilisant une IA,  
**afin de** gagner du temps en cas de structure ou wording différent entre ancien et nouveau site.

## ✅ Critères d'acceptation

### Fonctionnalités core
- [ ] Utilisation de GPT-3.5-turbo pour le matching sémantique
- [ ] Analyse du sens et du contenu de chaque URL (pas seulement les mots-clés)
- [ ] Score de confidence pour chaque correspondance (0.0 à 1.0)
- [ ] Rejection automatique des correspondances avec confidence < 0.7

### Interface utilisateur
- [ ] Checkbox "Activer le matching IA" dans l'interface
- [ ] Affichage des correspondances suggérées avec scores de confidence
- [ ] Code couleur : Vert (>0.9), Orange (0.7-0.9), Rouge (<0.7)

### Performance et fiabilité
- [ ] Chunking pour traiter 1000+ URLs (50 URLs par batch)
- [ ] Gestion des erreurs avec retry et fallback
- [ ] Timeout de 30 secondes par chunk
- [ ] Parallélisation limitée à 3 requêtes simultanées

### Qualité du matching
- [ ] Taux de matching > 80% avec confidence > 0.7
- [ ] Correspondance 1:1 (une ancienne URL = une nouvelle URL maximum)
- [ ] URLs non matchées clairement identifiées

## 🔧 Spécifications techniques

### API Configuration
```python
MODEL = "gpt-3.5-turbo"
TEMPERATURE = 0.1  # Précision maximale
MAX_TOKENS = 4000
CHUNK_SIZE = 50
MAX_RETRIES = 3
```

### Format de réponse IA
```json
{
    "correspondances": [
        {
            "ancienne": "https://site.com/camping-presentation-gard",
            "nouvelle": "/presentation",
            "confidence": 0.95,
            "raison": "Correspondance évidente : présentation du camping"
        }
    ],
    "non_matchees": ["https://site.com/page-obsolete"]
}
```

## 🧪 Scénarios de test

### Test 1: Matching évident
```
Entrée:
- Ancien: /camping-presentation-gard
- Nouveau: /presentation
Attendu: confidence > 0.9
```

### Test 2: Wording différent
```
Entrée:
- Ancien: /mobil-home-luxe  
- Nouveau: /nos-locatifs
Contexte: "mobil-home devient nos locatifs"
Attendu: confidence > 0.8
```

### Test 3: Pas de correspondance
```
Entrée:
- Ancien: /page-obsolete-2019
- Nouveau: [aucune page similaire]
Attendu: Non matché (confidence < 0.7)
```

## 📊 Métriques de succès

- **Précision** : 90% des suggestions avec confidence > 0.8 sont validées par l'utilisateur
- **Couverture** : 80% des anciennes URLs obtiennent une suggestion
- **Performance** : < 2 minutes pour traiter 1000 URLs
- **Coût** : < 5€ de coût API pour 1000 URLs

## 🚫 Exclusions

- Matching entre langues différentes (géré par US012)
- Interface de validation manuelle (géré par US010)
- Prompt contextuel du chef de projet (géré par US014)

## 🔄 Statut
**🔄 À développer** - Prêt pour implémentation après validation des specs techniques

---

*US009 développée pour SEPTEO Digital Services*  
*Matching IA sémantique avec GPT-3.5-turbo*