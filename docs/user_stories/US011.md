# US011 - DÃ©tection Automatique des Langues

## ğŸ“‹ Contexte
Les sites multilingues nÃ©cessitent une gestion spÃ©cifique des redirections pour Ã©viter les correspondances incorrectes entre langues diffÃ©rentes (FRâ†’EN, ESâ†’DE, etc.).

## ğŸ¯ User Story

**En tant que** responsable SEO multilingue,  
**je veux** que l'outil dÃ©tecte automatiquement la langue des URLs,  
**afin que** le matching se fasse uniquement entre langues identiques (FR/FR, EN/EN...).

## âœ… CritÃ¨res d'acceptation

### DÃ©tection automatique
- [ ] Reconnaissance des patterns linguistiques courants
- [ ] Support des formats : `/fr/`, `/en/`, `-fr.`, `.en/`, etc.
- [ ] DÃ©tection des sous-domaines : `fr.site.com`, `en.site.com`
- [ ] Langue par dÃ©faut configurable (FR par dÃ©faut)
- [ ] Gestion des URLs sans indication de langue

### Langues supportÃ©es
- [ ] FranÃ§ais (fr) - PrioritÃ© 1
- [ ] Anglais (en) - PrioritÃ© 1  
- [ ] Allemand (de) - PrioritÃ© 1
- [ ] Espagnol (es) - PrioritÃ© 2
- [ ] Italien (it) - PrioritÃ© 2
- [ ] NÃ©erlandais (nl) - PrioritÃ© 2

### Affichage et groupement
- [ ] RÃ©partition visuelle des URLs par langue
- [ ] Compteurs par langue (Ancien : FR 400, EN 200, etc.)
- [ ] Identification des langues dÃ©sÃ©quilibrÃ©es
- [ ] Alertes pour langues complÃ¨tement absentes

## ğŸ” Patterns de DÃ©tection

### Patterns supportÃ©s par langue
```python
LANGUAGE_PATTERNS = {
    'fr': [
        r'^/fr/',           # /fr/contact
        r'/(fr)$',          # /contact/fr
        r'-fr[./]',         # /contact-fr.html
        r'\.fr/',           # domain.fr/page
        r'fr\..*\.com'      # fr.site.com
    ],
    'en': [
        r'^/en/',           # /en/contact  
        r'/(en)$',          # /contact/en
        r'-en[./]',         # /contact-en.html
        r'\.co\.uk/',       # domain.co.uk/page
        r'en\..*\.com'      # en.site.com
    ],
    'de': [
        r'^/de/',           # /de/kontakt
        r'/(de)$',          # /kontakt/de
        r'-de[./]',         # /kontakt-de.html
        r'\.de/',           # domain.de/page
        r'de\..*\.com'      # de.site.com
    ]
}
```

### Exemples de dÃ©tection
| URL | Langue dÃ©tectÃ©e | Pattern utilisÃ© |
|-----|----------------|-----------------|
| `/fr/camping-presentation` | FR | PrÃ©fixe `/fr/` |
| `/contact-en.html` | EN | Suffixe `-en` |
| `es.campinglescascades.com/servicios` | ES | Sous-domaine |
| `/contact` | FR | DÃ©faut configurÃ© |
| `/de/uber-uns` | DE | PrÃ©fixe `/de/` |

## ğŸ—ï¸ SpÃ©cifications techniques

### Classe LanguageDetector
```python
class LanguageDetector:
    def __init__(self, default_language: str = 'fr'):
        self.default_language = default_language
        self.patterns = LANGUAGE_PATTERNS
    
    def detect(self, url: str) -> str:
        """DÃ©tecte la langue d'une URL"""
        
    def detect_bulk(self, urls: List[str]) -> Dict[str, str]:
        """DÃ©tecte les langues pour une liste d'URLs"""
        
    def group_by_language(self, urls: List[str]) -> Dict[str, List[str]]:
        """Groupe les URLs par langue dÃ©tectÃ©e"""
        
    def get_language_stats(self, urls: List[str]) -> Dict[str, int]:
        """Statistiques de rÃ©partition par langue"""
```

### Algorithme de dÃ©tection
```python
def detect_language(url: str) -> str:
    # 1. Test des patterns par ordre de prioritÃ©
    for lang, patterns in LANGUAGE_PATTERNS.items():
        for pattern in patterns:
            if re.search(pattern, url, re.IGNORECASE):
                return lang
    
    # 2. Fallback sur langue par dÃ©faut
    return self.default_language
```

## ğŸ¨ Interface utilisateur

### Affichage de rÃ©partition
```
ğŸŒ DÃ©tection automatique des langues

ğŸ“Š RÃ©partition ancien site (800 URLs) :
â”œâ”€â”€ ğŸ‡«ğŸ‡· FranÃ§ais : 400 URLs (50%)
â”œâ”€â”€ ğŸ‡¬ğŸ‡§ Anglais : 200 URLs (25%)  
â”œâ”€â”€ ğŸ‡©ğŸ‡ª Allemand : 100 URLs (12.5%)
â”œâ”€â”€ ğŸ‡ªğŸ‡¸ Espagnol : 80 URLs (10%)
â””â”€â”€ ğŸ‡®ğŸ‡¹ Italien : 20 URLs (2.5%)

ğŸ“Š RÃ©partition nouveau site (549 URLs) :
â”œâ”€â”€ ğŸ‡«ğŸ‡· FranÃ§ais : 300 URLs (55%)
â”œâ”€â”€ ğŸ‡¬ğŸ‡§ Anglais : 150 URLs (27%)
â”œâ”€â”€ ğŸ‡©ğŸ‡ª Allemand : 99 URLs (18%)
â”œâ”€â”€ ğŸ‡ªğŸ‡¸ Espagnol : 0 URLs (0%) âš ï¸
â””â”€â”€ ğŸ‡®ğŸ‡¹ Italien : 0 URLs (0%) âš ï¸
```

### Alertes de dÃ©sÃ©quilibre
- ğŸŸ¡ **Attention** : Langue prÃ©sente dans ancien mais pas nouveau (ES, IT)
- ğŸ”´ **Critique** : Plus de 50% d'Ã©cart entre ancien/nouveau pour une langue
- â„¹ï¸ **Info** : Suggestion de fallback 302 pour langues manquantes

## ğŸ§ª Tests de dÃ©tection

### Test 1: Patterns courants
```python
test_cases = [
    ("/fr/contact", "fr"),
    ("/en/about-us", "en"), 
    ("/de/uber-uns", "de"),
    ("/contact-es.html", "es"),
    ("fr.site.com/page", "fr"),
    ("/simple-page", "fr")  # dÃ©faut
]
```

### Test 2: URLs rÃ©elles
```python
real_urls = [
    "https://www.campinglescascades.com/fr/camping-presentation-gard",
    "http://72.web.thelis.es:30178/les-cascades/nl/contact",
    "/en/mobile-home-luxury",
    "/restaurant" # dÃ©faut FR
]
```

### Test 3: Performance
- [ ] DÃ©tection de 1000 URLs en < 1 seconde
- [ ] MÃ©moire : < 10MB pour 10k URLs
- [ ] Pas de regex catastrophique

## ğŸ“Š MÃ©triques de qualitÃ©

### PrÃ©cision de dÃ©tection
- **Patterns explicites** : 99% de prÃ©cision attendue
- **Fallback dÃ©faut** : ConfigurabilitÃ© selon le site
- **Faux positifs** : < 1% (ex: `/friend/` dÃ©tectÃ© comme FR)

### Couverture linguistique
- **Obligatoire** : FR, EN, DE (cas d'usage principal)
- **Optionnel** : ES, IT, NL (extension future)
- **Extensible** : Ajout facile de nouveaux patterns

## ğŸš« Exclusions

- DÃ©tection du contenu textuel des pages (hors scope)
- Translation automatique entre langues
- Matching entre langues diffÃ©rentes (gÃ©rÃ© par US012)
- Gestion des fallbacks 302 (gÃ©rÃ© par US013)

## ğŸ”„ Statut
**ğŸ”„ Ã€ dÃ©velopper** - Module de dÃ©tection avec patterns regex

---

*US011 dÃ©veloppÃ©e pour SEPTEO Digital Services*  
*DÃ©tection automatique des langues pour sites multilingues*