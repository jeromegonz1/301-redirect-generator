# US012 - Matching CloisonnÃ© par Langue

## ðŸ“‹ Contexte
Pour prÃ©server la cohÃ©rence SEO et Ã©viter les erreurs de redirection, le matching (IA ou manuel) ne doit se faire qu'entre URLs de mÃªme langue.

## ðŸŽ¯ User Story

**En tant que** responsable SEO multilingue,  
**je veux** que le matching IA et manuel se fasse uniquement Ã  l'intÃ©rieur d'un mÃªme groupe de langue dÃ©tectÃ©,  
**afin d'** Ã©viter les redirections incorrectes entre langues (ex: FRâ†’EN, ESâ†’DE).

## âœ… CritÃ¨res d'acceptation

### Cloisonnement strict
- [ ] Matching FR ancien â†’ FR nouveau uniquement
- [ ] Matching EN ancien â†’ EN nouveau uniquement  
- [ ] Interdiction totale de correspondances inter-langues
- [ ] Gestion sÃ©parÃ©e de chaque groupe linguistique

### Interface cloisonnÃ©e
- [ ] Onglets ou sections par langue dans l'interface
- [ ] Validation indÃ©pendante pour chaque langue
- [ ] Statistiques sÃ©parÃ©es par groupe linguistique
- [ ] Export cloisonnÃ© par langue

### Gestion des dÃ©sÃ©quilibres
- [ ] Alertes pour langues avec 0 correspondance possible
- [ ] Suggestion automatique de fallbacks 302
- [ ] Option de dÃ©sactivation du matching pour certaines langues
- [ ] Rapport des URLs orphelines par langue

## ðŸ—ï¸ Architecture de cloisonnement

### Groupement initial
```python
# Ã‰tape 1: Groupement par langue
old_urls_grouped = {
    'fr': ['/fr/contact', '/fr/services', ...],
    'en': ['/en/contact', '/en/about', ...],
    'de': ['/de/kontakt', '/de/services', ...],
    'es': ['/es/contacto', '/es/servicios', ...]
}

new_urls_grouped = {
    'fr': ['/fr/contact-nous', '/fr/nos-services', ...],
    'en': ['/en/contact-us', '/en/our-services', ...],
    'de': ['/de/kontakt-uns', '/de/unsere-services', ...],
    'es': []  # Langue non migrÃ©e
}
```

### Matching par langue
```python
# Ã‰tape 2: Matching indÃ©pendant par langue
for language in ['fr', 'en', 'de']:
    if language in new_urls_grouped:
        matches = ai_match(
            old_urls=old_urls_grouped[language],
            new_urls=new_urls_grouped[language],
            language=language
        )
    else:
        # Langue absente â†’ Fallback 302
        fallbacks = generate_302_fallbacks(
            old_urls=old_urls_grouped[language],
            target='/fr/'
        )
```

## ðŸŽ¨ Interface utilisateur

### Navigation par langue
```
ðŸŒ Matching par langue

ðŸ“‘ Onglets:
[ðŸ‡«ðŸ‡· FR (400â†’300)] [ðŸ‡¬ðŸ‡§ EN (200â†’150)] [ðŸ‡©ðŸ‡ª DE (100â†’99)] [ðŸ‡ªðŸ‡¸ ES (80â†’0)]

--- Onglet FR actif ---
âœ… Matching IA disponible (300 nouvelles URLs)
ðŸ“Š Correspondances trouvÃ©es : 275/400
ðŸ” 25 URLs sans correspondance â†’ Fallback /fr/

[Tableau de validation pour URLs FR uniquement]
```

### Statistiques par langue
```
ðŸ“Š Tableau de bord multilingue

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Langue  â”‚ Ancien site  â”‚ Nouveau site  â”‚ MatchÃ©es IA  â”‚ Fallbacks   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ‡«ðŸ‡· FR   â”‚ 400          â”‚ 300           â”‚ 275          â”‚ 25          â”‚
â”‚ ðŸ‡¬ðŸ‡§ EN   â”‚ 200          â”‚ 150           â”‚ 140          â”‚ 60          â”‚
â”‚ ðŸ‡©ðŸ‡ª DE   â”‚ 100          â”‚ 99            â”‚ 95           â”‚ 5           â”‚
â”‚ ðŸ‡ªðŸ‡¸ ES   â”‚ 80           â”‚ 0             â”‚ 0            â”‚ 80 (302)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”§ SpÃ©cifications techniques

### Classe LanguageMatchingEngine
```python
class LanguageMatchingEngine:
    def __init__(self, ai_mapper: AIMapper, detector: LanguageDetector):
        self.ai_mapper = ai_mapper
        self.detector = detector
    
    def match_by_language(self, old_urls: List[str], new_urls: List[str]) -> Dict[str, MatchResult]:
        """Effectue le matching cloisonnÃ© par langue"""
        
    def generate_language_report(self) -> LanguageReport:
        """GÃ©nÃ¨re un rapport par langue"""
        
    def export_by_language(self, language: str) -> Tuple[str, str]:
        """Exporte .htaccess et CSV pour une langue spÃ©cifique"""
```

### Algorithme de cloisonnement
```python
def match_by_language(old_urls, new_urls):
    results = {}
    
    # Groupement par langue
    old_grouped = detector.group_by_language(old_urls)
    new_grouped = detector.group_by_language(new_urls)
    
    for language in old_grouped.keys():
        if language in new_grouped:
            # Matching IA normal
            results[language] = ai_mapper.match_urls(
                old_urls=old_grouped[language],
                new_urls=new_grouped[language],
                language=language
            )
        else:
            # Langue absente â†’ Fallback
            results[language] = generate_fallback_302(
                old_urls=old_grouped[language],
                target=f'/{DEFAULT_LANGUAGE}/'
            )
    
    return results
```

## ðŸ§ª ScÃ©narios de test

### Test 1: Cloisonnement strict
```
DonnÃ©:
- FR ancien: ['/fr/contact', '/fr/services']
- EN ancien: ['/en/about', '/en/pricing']
- FR nouveau: ['/fr/contact-nous']
- EN nouveau: ['/en/about-us']

Attendu:
- /fr/contact â†’ /fr/contact-nous (FRâ†’FR uniquement)
- /en/about â†’ /en/about-us (ENâ†’EN uniquement)
- Aucune correspondance FRâ†’EN ou ENâ†’FR
```

### Test 2: Langue manquante
```
DonnÃ©:
- ES ancien: ['/es/contacto', '/es/servicios']
- ES nouveau: [] (vide)

Attendu:
- Toutes les URLs ES â†’ Fallback 302 vers /fr/
- Aucun matching IA tentÃ© pour ES
```

### Test 3: DÃ©sÃ©quilibre numÃ©rique
```
DonnÃ©:
- EN ancien: 200 URLs
- EN nouveau: 50 URLs

Attendu:
- 50 meilleures correspondances IA
- 150 URLs â†’ Fallback 302 vers /en/ (home anglaise)
```

## ðŸ“Š MÃ©triques par langue

### Dashboard dÃ©taillÃ©
```
ðŸŽ¯ Performance du matching cloisonnÃ©

ðŸ‡«ðŸ‡· FranÃ§ais (Langue principale):
â”œâ”€â”€ Taux de matching: 89% (275/309)
â”œâ”€â”€ Confidence moyenne: 0.87
â””â”€â”€ Temps de traitement: 45s

ðŸ‡¬ðŸ‡§ Anglais (Langue secondaire):
â”œâ”€â”€ Taux de matching: 70% (140/200)
â”œâ”€â”€ Confidence moyenne: 0.81
â””â”€â”€ Temps de traitement: 32s

ðŸ‡ªðŸ‡¸ Espagnol (Non migrÃ©):
â”œâ”€â”€ Taux de matching: 0% (fallback total)
â”œâ”€â”€ URLs concernÃ©es: 80
â””â”€â”€ Redirection: 302 â†’ /fr/
```

### Alertes qualitÃ©
- ðŸŸ¡ **DÃ©sÃ©quilibre** : Langue avec < 50% de matching possible
- ðŸ”´ **Critique** : Langue principale avec < 80% de matching
- â„¹ï¸ **Info** : Langues non migrÃ©es avec fallback 302

## ðŸš« Exclusions

- Matching automatique inter-langues (strictement interdit)
- Translation automatique entre langues
- DÃ©tection du contenu pour amÃ©liorer le matching (US011 uniquement)
- Interface de validation globale (US010 reste multilingue)

## ðŸ”„ Statut
**ðŸ”„ Ã€ dÃ©velopper** - Engine de matching avec cloisonnement linguistique

---

*US012 dÃ©veloppÃ©e pour SEPTEO Digital Services*  
*Matching cloisonnÃ© par langue pour SEO multilingue*